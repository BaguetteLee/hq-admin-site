<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>总部管理系统 - 任务完成审核（重构v4-争议优先）</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    :root{
      --primary:#3b7ddd; --primary-light:#e8f0fe; --white:#ffffff; --light:#f5f6f8;
      --border:#e2e8f0; --text:#2d3748; --dot-platform:#3b7ddd; --dot-user:#2fb67b; --dot-team:#f6a035; --dot-system:#7a5af8;
    }
    body{background-color:var(--light);font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;color:var(--text);}

    .sidebar{background-color:var(--white);color:#4a5568;height:100vh;position:fixed;left:0;top:0;width:260px;padding-top:60px;box-shadow:2px 0 10px rgba(0,0,0,0.05);border-right:1px solid var(--border);z-index:1000;overflow-y:auto;}
    .sidebar .nav-link{color:#4a5568;padding:.8rem 1rem;margin:.1rem .5rem;border-radius:6px;transition:all .2s;display:flex;align-items:center;gap:.55rem;}
    .sidebar .nav-link i{color:#718096;}
    .sidebar .nav-link:hover,.sidebar .nav-link.active{color:var(--primary);background-color:var(--primary-light);}
    .sidebar .nav-link.active i,.sidebar .nav-link:hover i{color:var(--primary);}
    .sidebar .menu-section{padding:.75rem 1rem .25rem;color:#94a3b8;font-weight:700;text-transform:uppercase;font-size:.75rem;letter-spacing:.06em;}
    .cat-dot{display:inline-block;width:.6rem;height:.6rem;border-radius:2px;flex:0 0 auto;}
    .dot-platform{background-color:var(--dot-platform);} .dot-user{background-color:var(--dot-user);} .dot-team{background-color:var(--dot-team);} .dot-system{background-color:var(--dot-system);}

    .main-content{margin-left:260px;padding:20px;padding-top:80px;transition:margin-left .3s;}
    .navbar{background-color:var(--white);box-shadow:0 2px 10px rgba(0,0,0,.05);border-bottom:1px solid var(--border);position:fixed;top:0;left:0;right:0;z-index:1030;padding-left:260px;transition:padding-left .3s;}
    .navbar-brand{color:var(--primary);font-weight:700;display:flex;align-items:center;gap:.6rem;}
    .navbar-toggler{display:none;border:none;font-size:1.25rem;} .navbar-toggler:focus{box-shadow:none;}

    .dashboard-card{background:var(--white);border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,.04);margin-bottom:24px;border:none;}
    .card-header{background-color:var(--white);border-bottom:1px solid var(--border);font-weight:600;padding:1rem 1.5rem;}
    .card-body{padding:1.5rem;}
    .table th{font-weight:600;color:#4a5568;border-top:none;border-bottom:2px solid var(--border);}
    .table-hover tbody tr:hover{background-color:#f8f9fa;}

    .badge-soft-warning{background:#fff8e1;color:#b7791f;border:1px solid #f6e05e;}
    .badge-soft-info{background:#ebf8ff;color:#2b6cb0;border:1px solid #90cdf4;}
    .badge-soft-success{background:#e6fffa;color:#2c7a7b;border:1px solid #81e6d9;}
    .badge-soft-danger{background:#fff5f5;color:#c53030;border:1px solid #feb2b2;}
    .badge-soft-primary{background:#e7f1ff;color:#1d4ed8;border:1px solid #a3c5ff;}

    .batch-actions{background-color:var(--primary-light);padding:1rem;border-radius:8px;margin-bottom:1rem;display:none;}
    .selected-count{font-weight:700;color:var(--primary);}
    .urgency-indicator{width:12px;height:12px;border-radius:50%;display:inline-block;margin-right:5px;}
    .urgency-high{background-color:#dc3545;} .urgency-medium{background-color:#fd7e14;} .urgency-low{background-color:#28a745;}
    .image-preview{max-width:100%;max-height:200px;border-radius:6px;margin-right:10px;margin-bottom:10px;cursor:pointer;transition:transform .2s;}
    .image-preview:hover{transform:scale(1.05);} .modal-image{width:100%;border-radius:8px;}

    .bounty-card{background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);border-radius:8px;padding:1rem;margin-bottom:1rem;border-left:4px solid #28a745;}
    .bounty-amount{font-size:1.5rem;font-weight:700;color:#28a745;}
    .info-card{background-color:#f8f9fa;border-radius:8px;padding:1rem;margin-bottom:1rem;}
    .info-label{font-weight:600;color:#4a5568;margin-bottom:.25rem;} .info-value{color:#2d3748;}

    .timeline{border-left:3px solid var(--border);padding-left:12px;margin-left:6px;}
    .timeline .item{position:relative;margin-bottom:.75rem;}
    .timeline .item::before{content:'';position:absolute;left:-10px;top:.25rem;width:8px;height:8px;border-radius:50%;background:#1d4ed8;}

    .countdown{font-variant-numeric: tabular-nums;}
    .countdown.near{color:#d97706;} .countdown.expired{color:#c53030;}

    .pagination { margin-bottom: 0; }
    .page-size-hint{ color:#6c757d; }

    @media (max-width: 992px){
      .sidebar{width:84px;padding-top:70px;}
      .sidebar .nav-link span.text{display:none;}
      .sidebar .menu-section{display:none;}
      .main-content{margin-left:84px;}
      .navbar{padding-left:84px;}
    }
    @media (max-width: 768px){
      .sidebar{transform:translateX(-100%);width:260px;}
      .sidebar.show{transform:translateX(0);}
      .main-content{margin-left:0;}
      .navbar{padding-left:15px;}
      .navbar-toggler{display:block;}
    }
  </style>
</head>
<body>
  <!-- 顶部导航栏 -->
  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" id="sidebarToggle">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="#"><strong><i class="bi bi-building me-2"></i>总部管理系统</strong></a>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto me-5">
          <li class="nav-item dropdown ms-2">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
              <i class="bi bi-person-circle me-2"></i> 管理员
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#" id="btnLogout"><i class="bi bi-box-arrow-right me-2"></i>退出</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- 侧边栏（与 dashboard 一致，本页高亮） -->
  <aside class="sidebar">
    <div class="position-sticky">
      <ul class="nav flex-column">
        <li class="menu-section">平台</li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-dashboard.html"><span class="cat-dot dot-platform"></span><i class="bi bi-speedometer2"></i><span class="text">平台总仪表盘</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-finance-platform-fund-flow.html"><span class="cat-dot dot-platform"></span><i class="bi bi-currency-exchange"></i><span class="text">平台资金流水</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-tasks-global-management.html"><span class="cat-dot dot-platform"></span><i class="bi bi-list-task"></i><span class="text">任务全局管理</span></a></li>
        <li class="menu-section">用户</li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-users-list.html"><span class="cat-dot dot-user"></span><i class="bi bi-people"></i><span class="text">平台用户列表</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-finance-recharge-review.html"><span class="cat-dot dot-user"></span><i class="bi bi-wallet2"></i><span class="text">用户充值审核</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-finance-withdrawal-review.html"><span class="cat-dot dot-user"></span><i class="bi bi-cash-coin"></i><span class="text">用户提现审核</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-finance-user-fund-flow.html"><span class="cat-dot dot-user"></span><i class="bi bi-currency-exchange"></i><span class="text">用户资金流水</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-users-feedback.html"><span class="cat-dot dot-user"></span><i class="bi bi-chat-left-text"></i><span class="text">用户投诉反馈</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-audit-task-publish.html"><span class="cat-dot dot-user"></span><i class="bi bi-send-check"></i><span class="text">用户发布审核</span></a></li>
        <li class="nav-item"><a class="nav-link active" href="hq-admin-audit-task-completion.html"><span class="cat-dot dot-user"></span><i class="bi bi-check2-circle"></i><span class="text">任务完成审核</span></a></li>
        <li class="menu-section">团队</li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-team-dashboard.html"><span class="cat-dot dot-team"></span><i class="bi bi-graph-up"></i><span class="text">团队数据概览</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-team-list.html"><span class="cat-dot dot-team"></span><i class="bi bi-building"></i><span class="text">平台团队列表</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-finance-team-withdrawal-review.html"><span class="cat-dot dot-team"></span><i class="bi bi-bank"></i><span class="text">团队提现审核</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-finance-team-fund-flow.html"><span class="cat-dot dot-team"></span><i class="bi bi-currency-exchange"></i><span class="text">团队资金流水</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-team-feedback.html"><span class="cat-dot dot-team"></span><i class="bi bi-chat-left-text"></i><span class="text">团队投诉反馈</span></a></li>
        <li class="menu-section">系统</li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-settings-categories.html"><span class="cat-dot dot-system"></span><i class="bi bi-tags"></i><span class="text">业务分类管理</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-system-api-management-monitoring.html"><span class="cat-dot dot-system"></span><i class="bi bi-hdd-network"></i><span class="text">接口管理监控</span></a></li>
        <li class="nav-item"><a class="nav-link" href="hq-admin-settings-system.html"><span class="cat-dot dot-system"></span><i class="bi bi-gear-fill"></i><span class="text">系统设置</span></a></li>
      </ul>
    </div>
  </aside>

  <!-- 主内容 -->
  <main class="main-content">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="mb-0">任务完成审核</h4>
      <div></div>
    </div>

    <!-- 顶部筛选卡片：左侧 KPI（异议中｜处理中），右侧视图标签 -->
    <div class="dashboard-card card mb-3">
      <div class="card-body">
        <div class="row g-3 align-items-center">
          <div class="col-md-6">
            <div class="small text-muted">
              异议中：<span class="fw-bold text-primary" id="kpiDispute">0</span>
              &nbsp;|&nbsp;
              处理中：<span class="fw-bold text-primary" id="kpiProcessing">0</span>
            </div>
          </div>
          <div class="col-md-6 text-md-end">
            <ul class="nav nav-pills justify-content-md-end" id="viewTabs">
              <li class="nav-item"><button class="nav-link active" data-view="dispute">异议中</button></li>
              <li class="nav-item"><button class="nav-link" data-view="processing">处理中</button></li>
              <li class="nav-item"><button class="nav-link" data-view="processed">已处理</button></li>
              <li class="nav-item"><button class="nav-link" data-view="pending">待审核</button></li>
              <li class="nav-item"><button class="nav-link" data-view="all">全部</button></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- 批量操作条 -->
    <div class="batch-actions" id="batchActions">
      <div class="d-flex justify-content-between align-items-center">
        <div>已选择 <span class="selected-count" id="selectedCount">0</span> 条</div>
        <div>
          <button class="btn btn-sm btn-success me-2" id="batchApproveBtn"><i class="bi bi-check-circle"></i> 批量通过</button>
          <button class="btn btn-sm btn-primary me-2" id="batchNoObjectionBtn"><i class="bi bi-hand-thumbs-up"></i> 批量确认无异议</button>
          <button class="btn btn-sm btn-danger me-2" id="batchRejectBtn"><i class="bi bi-x-circle"></i> 批量驳回</button>
          <button class="btn btn-sm btn-outline-warning" id="batchToDisputeBtn"><i class="bi bi-arrow-left-right"></i> 批量转入异议栏</button>
        </div>
      </div>
    </div>

    <!-- 列表 -->
    <div class="dashboard-card card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>任务完成申请列表</span>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0" id="completionTable">
            <thead>
              <tr>
                <th width="50"><input type="checkbox" class="form-check-input" id="selectAll"></th>
                <th>任务ID</th>
                <th>任务分类</th>
                <th>提交用户</th>
                <th>所属团队</th>
                <th>提交时间</th>
                <th>已提交</th>
                <th>自动确认</th>
                <th>赏金</th>
                <th>服务费</th>
                <th>到手赏金</th>
                <th>审核状态</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr data-status="pending" data-category="推广营销" data-rel-hours="1">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1000</td>
                <td>推广营销</td>
                <td>用户A</td>
                <td>星海传媒</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-low"></span><span class="elapsed">1小时</span></td>
                <td class="countdown">计算中…</td>
                <td>¥80.00</td>
                <td>¥8.00</td>
                <td>¥72.00</td>
                <td><span class="badge badge-soft-warning">待发单确认</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="0" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="pending" data-category="测评写作" data-rel-hours="3">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1001</td>
                <td>测评写作</td>
                <td>用户B</td>
                <td>创智科技</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-low"></span><span class="elapsed">3小时</span></td>
                <td class="countdown">计算中…</td>
                <td>¥100.00</td>
                <td>¥10.00</td>
                <td>¥90.00</td>
                <td><span class="badge badge-soft-warning">待发单确认</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="1" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="pending" data-category="话题引流" data-rel-hours="5">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1002</td>
                <td>话题引流</td>
                <td>用户C</td>
                <td>优创团队</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-low"></span><span class="elapsed">5小时</span></td>
                <td class="countdown">计算中…</td>
                <td>¥120.00</td>
                <td>¥12.00</td>
                <td>¥108.00</td>
                <td><span class="badge badge-soft-warning">待发单确认</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="2" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="pending" data-category="视频制作" data-rel-hours="7">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1003</td>
                <td>视频制作</td>
                <td>用户D</td>
                <td>青竹工作室</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">7小时</span></td>
                <td class="countdown">计算中…</td>
                <td>¥140.00</td>
                <td>¥14.00</td>
                <td>¥126.00</td>
                <td><span class="badge badge-soft-warning">待发单确认</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="3" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="pending" data-category="图文设计" data-rel-hours="9">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1004</td>
                <td>图文设计</td>
                <td>用户E</td>
                <td>极光网络</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">9小时</span></td>
                <td class="countdown">计算中…</td>
                <td>¥160.00</td>
                <td>¥16.00</td>
                <td>¥144.00</td>
                <td><span class="badge badge-soft-warning">待发单确认</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="4" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="pending" data-category="站外引流" data-rel-hours="11">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1005</td>
                <td>站外引流</td>
                <td>用户F</td>
                <td>晨曦互联</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">11小时</span></td>
                <td class="countdown">计算中…</td>
                <td>¥80.00</td>
                <td>¥8.00</td>
                <td>¥72.00</td>
                <td><span class="badge badge-soft-warning">待发单确认</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="5" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="pending" data-category="直播扶持" data-rel-hours="13">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1006</td>
                <td>直播扶持</td>
                <td>用户G</td>
                <td>星海传媒</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">13小时</span></td>
                <td class="countdown">计算中…</td>
                <td>¥100.00</td>
                <td>¥10.00</td>
                <td>¥90.00</td>
                <td><span class="badge badge-soft-warning">待发单确认</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="6" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="pending" data-category="问答互动" data-rel-hours="15">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1007</td>
                <td>问答互动</td>
                <td>用户H</td>
                <td>创智科技</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">15小时</span></td>
                <td class="countdown">计算中…</td>
                <td>¥120.00</td>
                <td>¥12.00</td>
                <td>¥108.00</td>
                <td><span class="badge badge-soft-warning">待发单确认</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="7" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="pending" data-category="SEO优化" data-rel-hours="17">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1008</td>
                <td>SEO优化</td>
                <td>用户I</td>
                <td>优创团队</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">17小时</span></td>
                <td class="countdown">计算中…</td>
                <td>¥140.00</td>
                <td>¥14.00</td>
                <td>¥126.00</td>
                <td><span class="badge badge-soft-warning">待发单确认</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="8" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="pending" data-category="推广营销" data-rel-hours="19">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1009</td>
                <td>推广营销</td>
                <td>用户J</td>
                <td>青竹工作室</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">19小时</span></td>
                <td class="countdown">计算中…</td>
                <td>¥160.00</td>
                <td>¥16.00</td>
                <td>¥144.00</td>
                <td><span class="badge badge-soft-warning">待发单确认</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="9" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="dispute" data-category="话题引流" data-rel-hours="6" data-dispute="截图缺少指定话题标签">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1010</td>
                <td>话题引流</td>
                <td>用户F</td>
                <td>青竹工作室</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">6小时</span></td>
                <td class="countdown">—</td>
                <td>¥100.00</td>
                <td>¥10.00</td>
                <td>¥90.00</td>
                <td><span class="badge badge-soft-info">异议中（等待平台裁定）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="10" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="dispute" data-category="视频制作" data-rel-hours="7" data-dispute="链接无法访问">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1011</td>
                <td>视频制作</td>
                <td>用户G</td>
                <td>极光网络</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">7小时</span></td>
                <td class="countdown">—</td>
                <td>¥130.00</td>
                <td>¥13.00</td>
                <td>¥117.00</td>
                <td><span class="badge badge-soft-info">异议中（等待平台裁定）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="11" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="dispute" data-category="图文设计" data-rel-hours="8" data-dispute="未在指定时间窗口完成">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1012</td>
                <td>图文设计</td>
                <td>用户H</td>
                <td>晨曦互联</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">8小时</span></td>
                <td class="countdown">—</td>
                <td>¥160.00</td>
                <td>¥16.00</td>
                <td>¥144.00</td>
                <td><span class="badge badge-soft-info">异议中（等待平台裁定）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="12" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="dispute" data-category="站外引流" data-rel-hours="9" data-dispute="证明材料模糊">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1013</td>
                <td>站外引流</td>
                <td>用户I</td>
                <td>星海传媒</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">9小时</span></td>
                <td class="countdown">—</td>
                <td>¥190.00</td>
                <td>¥19.00</td>
                <td>¥171.00</td>
                <td><span class="badge badge-soft-info">异议中（等待平台裁定）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="13" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="dispute" data-category="直播扶持" data-rel-hours="10" data-dispute="账号不匹配">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1014</td>
                <td>直播扶持</td>
                <td>用户J</td>
                <td>创智科技</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">10小时</span></td>
                <td class="countdown">—</td>
                <td>¥100.00</td>
                <td>¥10.00</td>
                <td>¥90.00</td>
                <td><span class="badge badge-soft-info">异议中（等待平台裁定）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="14" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="dispute" data-category="问答互动" data-rel-hours="11" data-dispute="未按地域要求投放">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1015</td>
                <td>问答互动</td>
                <td>用户K</td>
                <td>优创团队</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">11小时</span></td>
                <td class="countdown">—</td>
                <td>¥130.00</td>
                <td>¥13.00</td>
                <td>¥117.00</td>
                <td><span class="badge badge-soft-info">异议中（等待平台裁定）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="15" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="dispute" data-category="SEO优化" data-rel-hours="12" data-dispute="内容重复/抄袭">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1016</td>
                <td>SEO优化</td>
                <td>用户L</td>
                <td>青竹工作室</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">12小时</span></td>
                <td class="countdown">—</td>
                <td>¥160.00</td>
                <td>¥16.00</td>
                <td>¥144.00</td>
                <td><span class="badge badge-soft-info">异议中（等待平台裁定）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="16" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="dispute" data-category="推广营销" data-rel-hours="13" data-dispute="无原始数据后台截图">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1017</td>
                <td>推广营销</td>
                <td>用户M</td>
                <td>极光网络</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">13小时</span></td>
                <td class="countdown">—</td>
                <td>¥190.00</td>
                <td>¥19.00</td>
                <td>¥171.00</td>
                <td><span class="badge badge-soft-info">异议中（等待平台裁定）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="17" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="dispute" data-category="测评写作" data-rel-hours="14" data-dispute="缺少带货口令">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1018</td>
                <td>测评写作</td>
                <td>用户N</td>
                <td>晨曦互联</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">14小时</span></td>
                <td class="countdown">—</td>
                <td>¥100.00</td>
                <td>¥10.00</td>
                <td>¥90.00</td>
                <td><span class="badge badge-soft-info">异议中（等待平台裁定）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="18" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="dispute" data-category="话题引流" data-rel-hours="15" data-dispute="未达最低互动量">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1019</td>
                <td>话题引流</td>
                <td>用户O</td>
                <td>星海传媒</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">15小时</span></td>
                <td class="countdown">—</td>
                <td>¥130.00</td>
                <td>¥13.00</td>
                <td>¥117.00</td>
                <td><span class="badge badge-soft-info">异议中（等待平台裁定）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="19" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="processing" data-category="图文设计" data-rel-hours="12">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1020</td>
                <td>图文设计</td>
                <td>用户M</td>
                <td>创智科技</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">12小时</span></td>
                <td class="countdown">—</td>
                <td>¥120.00</td>
                <td>¥12.00</td>
                <td>¥108.00</td>
                <td><span class="badge badge-soft-primary">处理异议中（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="20" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="processing" data-category="站外引流" data-rel-hours="13">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1021</td>
                <td>站外引流</td>
                <td>用户N</td>
                <td>优创团队</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">13小时</span></td>
                <td class="countdown">—</td>
                <td>¥160.00</td>
                <td>¥16.00</td>
                <td>¥144.00</td>
                <td><span class="badge badge-soft-primary">处理异议中（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="21" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="processing" data-category="直播扶持" data-rel-hours="14">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1022</td>
                <td>直播扶持</td>
                <td>用户O</td>
                <td>青竹工作室</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">14小时</span></td>
                <td class="countdown">—</td>
                <td>¥200.00</td>
                <td>¥20.00</td>
                <td>¥180.00</td>
                <td><span class="badge badge-soft-primary">处理异议中（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="22" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="processing" data-category="问答互动" data-rel-hours="15">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1023</td>
                <td>问答互动</td>
                <td>用户P</td>
                <td>极光网络</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">15小时</span></td>
                <td class="countdown">—</td>
                <td>¥120.00</td>
                <td>¥12.00</td>
                <td>¥108.00</td>
                <td><span class="badge badge-soft-primary">处理异议中（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="23" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="processing" data-category="SEO优化" data-rel-hours="16">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1024</td>
                <td>SEO优化</td>
                <td>用户Q</td>
                <td>晨曦互联</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">16小时</span></td>
                <td class="countdown">—</td>
                <td>¥160.00</td>
                <td>¥16.00</td>
                <td>¥144.00</td>
                <td><span class="badge badge-soft-primary">处理异议中（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="24" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="processing" data-category="推广营销" data-rel-hours="17">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1025</td>
                <td>推广营销</td>
                <td>用户R</td>
                <td>星海传媒</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">17小时</span></td>
                <td class="countdown">—</td>
                <td>¥200.00</td>
                <td>¥20.00</td>
                <td>¥180.00</td>
                <td><span class="badge badge-soft-primary">处理异议中（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="25" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="processing" data-category="测评写作" data-rel-hours="18">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1026</td>
                <td>测评写作</td>
                <td>用户S</td>
                <td>创智科技</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">18小时</span></td>
                <td class="countdown">—</td>
                <td>¥120.00</td>
                <td>¥12.00</td>
                <td>¥108.00</td>
                <td><span class="badge badge-soft-primary">处理异议中（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="26" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="processing" data-category="话题引流" data-rel-hours="19">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1027</td>
                <td>话题引流</td>
                <td>用户T</td>
                <td>优创团队</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">19小时</span></td>
                <td class="countdown">—</td>
                <td>¥160.00</td>
                <td>¥16.00</td>
                <td>¥144.00</td>
                <td><span class="badge badge-soft-primary">处理异议中（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-primary audit-btn" data-row-index="27" data-bs-toggle="modal" data-bs-target="#completionDetailModal">审核</button></td>
              </tr>
    

              <tr data-status="approved" data-category="直播扶持" data-rel-hours="24">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1028</td>
                <td>直播扶持</td>
                <td>用户S</td>
                <td>优创团队</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-high"></span><span class="elapsed">24小时</span></td>
                <td class="countdown">—</td>
                <td>¥150.00</td>
                <td>¥15.00</td>
                <td>¥135.00</td>
                <td><span class="badge badge-soft-success">已通过（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="28" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="approved" data-category="问答互动" data-rel-hours="25">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1029</td>
                <td>问答互动</td>
                <td>用户T</td>
                <td>青竹工作室</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-high"></span><span class="elapsed">25小时</span></td>
                <td class="countdown">—</td>
                <td>¥200.00</td>
                <td>¥20.00</td>
                <td>¥180.00</td>
                <td><span class="badge badge-soft-success">已通过（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="29" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="approved" data-category="SEO优化" data-rel-hours="26">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1030</td>
                <td>SEO优化</td>
                <td>用户U</td>
                <td>极光网络</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-high"></span><span class="elapsed">26小时</span></td>
                <td class="countdown">—</td>
                <td>¥250.00</td>
                <td>¥25.00</td>
                <td>¥225.00</td>
                <td><span class="badge badge-soft-success">已通过（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="30" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="approved" data-category="推广营销" data-rel-hours="27">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1031</td>
                <td>推广营销</td>
                <td>用户V</td>
                <td>晨曦互联</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-high"></span><span class="elapsed">27小时</span></td>
                <td class="countdown">—</td>
                <td>¥150.00</td>
                <td>¥15.00</td>
                <td>¥135.00</td>
                <td><span class="badge badge-soft-success">已通过（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="31" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="rejected" data-category="问答互动" data-rel-hours="30">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1032</td>
                <td>问答互动</td>
                <td>用户F</td>
                <td>极光网络</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-high"></span><span class="elapsed">30小时</span></td>
                <td class="countdown">—</td>
                <td>¥90.00</td>
                <td>¥9.00</td>
                <td>¥81.00</td>
                <td><span class="badge badge-soft-danger">已驳回（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="32" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="rejected" data-category="SEO优化" data-rel-hours="31">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1033</td>
                <td>SEO优化</td>
                <td>用户G</td>
                <td>晨曦互联</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-high"></span><span class="elapsed">31小时</span></td>
                <td class="countdown">—</td>
                <td>¥150.00</td>
                <td>¥15.00</td>
                <td>¥135.00</td>
                <td><span class="badge badge-soft-danger">已驳回（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="33" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="rejected" data-category="推广营销" data-rel-hours="32">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1034</td>
                <td>推广营销</td>
                <td>用户H</td>
                <td>星海传媒</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-high"></span><span class="elapsed">32小时</span></td>
                <td class="countdown">—</td>
                <td>¥90.00</td>
                <td>¥9.00</td>
                <td>¥81.00</td>
                <td><span class="badge badge-soft-danger">已驳回（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="34" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="rejected" data-category="测评写作" data-rel-hours="33">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1035</td>
                <td>测评写作</td>
                <td>用户I</td>
                <td>创智科技</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-high"></span><span class="elapsed">33小时</span></td>
                <td class="countdown">—</td>
                <td>¥150.00</td>
                <td>¥15.00</td>
                <td>¥135.00</td>
                <td><span class="badge badge-soft-danger">已驳回（平台）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="35" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="confirmed" data-category="测评写作" data-rel-hours="5" data-confirmed-by="user">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1036</td>
                <td>测评写作</td>
                <td>用户H</td>
                <td>晨曦互联</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-low"></span><span class="elapsed">5小时</span></td>
                <td class="countdown">用户确认</td>
                <td>¥200.00</td>
                <td>¥20.00</td>
                <td>¥180.00</td>
                <td><span class="badge badge-soft-success">已确认（用户确认）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="36" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="confirmed" data-category="话题引流" data-rel-hours="6" data-confirmed-by="user">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1037</td>
                <td>话题引流</td>
                <td>用户I</td>
                <td>星海传媒</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-medium"></span><span class="elapsed">6小时</span></td>
                <td class="countdown">用户确认</td>
                <td>¥240.00</td>
                <td>¥24.00</td>
                <td>¥216.00</td>
                <td><span class="badge badge-soft-success">已确认（用户确认）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="37" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="confirmed" data-category="视频制作" data-rel-hours="50" data-confirmed-by="system">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1038</td>
                <td>视频制作</td>
                <td>用户J</td>
                <td>优创团队</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-high"></span><span class="elapsed">50小时</span></td>
                <td class="countdown">系统确认</td>
                <td>¥110.00</td>
                <td>¥11.00</td>
                <td>¥99.00</td>
                <td><span class="badge badge-soft-success">已确认（系统确认）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="38" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    

              <tr data-status="confirmed" data-category="图文设计" data-rel-hours="51" data-confirmed-by="system">
                <td><input type="checkbox" class="form-check-input select-item"></td>
                <td>1039</td>
                <td>图文设计</td>
                <td>用户K</td>
                <td>青竹工作室</td>
                <td>—</td>
                <td><span class="urgency-indicator urgency-high"></span><span class="elapsed">51小时</span></td>
                <td class="countdown">系统确认</td>
                <td>¥180.00</td>
                <td>¥18.00</td>
                <td>¥162.00</td>
                <td><span class="badge badge-soft-success">已确认（系统确认）</span></td>
                <td><button class="btn btn-sm btn-outline-secondary audit-btn" data-row-index="39" data-bs-toggle="modal" data-bs-target="#completionDetailModal">查看</button></td>
              </tr>
    </tbody>
          </table>
        </div>
      </div>
      <!-- 分页条 -->
      <div class="card-footer d-flex justify-content-between align-items-center">
        <div class="page-size-hint">每页 <strong>20</strong> 条 | 当前 <span id="pageInfo">1/1</span> | 共 <span id="totalCount">0</span> 条</div>
        <nav aria-label="任务分页">
          <ul class="pagination mb-0" id="pager">
            <li class="page-item"><a class="page-link" href="#" data-page="prev">上一页</a></li>
            <li class="page-item active"><a class="page-link" href="#" data-page="1">1</a></li>
            <li class="page-item"><a class="page-link" href="#" data-page="next">下一页</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </main>

  <!-- 审核/查看 模态框 -->
  <div class="modal fade" id="completionDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            完成申请审核 <small class="text-muted ms-2" id="modalSubTitle">任务分类：--（任务ID: --）</small>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- 流程轨迹 -->
          <div class="info-card mb-3">
            <div class="fw-bold mb-2">流程轨迹</div>
            <div class="row g-2">
              <div class="col-md-3"><span class="badge bg-secondary w-100"><i class="bi bi-upload"></i> 接单方提交凭证</span></div>
              <div class="col-md-3"><span class="badge bg-secondary w-100"><i class="bi bi-person-check"></i> 发单方确认</span></div>
              <div class="col-md-3"><span class="badge bg-secondary w-100"><i class="bi bi-flag"></i> 发单方异议</span></div>
              <div class="col-md-3"><span class="badge bg-secondary w-100"><i class="bi bi-hammer"></i> 平台裁定</span></div>
            </div>
          </div>

          <!-- 关键信息 -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="info-card">
                <div class="info-label">提交用户</div>
                <div class="info-value" id="mSubmitUser">--</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="info-card">
                <div class="info-label">提交时间</div>
                <div class="info-value" id="mSubmitTime">--</div>
              </div>
            </div>
          </div>

          <!-- 赏金信息 -->
          <div class="bounty-card mb-4">
            <h6 class="mb-3">赏金信息</h6>
            <div class="d-flex justify-content-between pb-1 border-bottom border-1 border-dashed">
              <span class="text-muted">任务赏金:</span><span class="fw-semibold" id="mBounty">--</span>
            </div>
            <div class="d-flex justify-content-between pb-1 border-bottom border-1 border-dashed">
              <span class="text-muted">平台服务费 (10%):</span><span class="fw-semibold" id="mFee">--</span>
            </div>
            <div class="d-flex justify-content-between pt-2">
              <span class="text-muted">用户到手赏金:</span><span class="bounty-amount" id="mNet">--</span>
            </div>
          </div>

          <!-- 提交内容 -->
          <h6 class="mb-3">提交内容</h6>
          <div class="submission-card card mb-4">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="d-flex align-items-center">
                  <img src="https://via.placeholder.com/40" class="rounded-circle me-2" alt="avatar">
                  <div>
                    <div class="fw-bold" id="mUser">--</div>
                    <small class="text-muted" id="mUserTime">--</small>
                  </div>
                </div>
                <span class="badge bg-warning" id="mStatusBadge">待审核</span>
              </div>
              <div class="info-label">提交说明</div>
              <div class="info-value mb-3" id="mDesc">已按要求完成操作并附上证明材料。</div>
              <div class="info-label">提交图片</div>
              <div class="d-flex flex-wrap mt-2" id="mImages">
                <img src="https://via.placeholder.com/150" class="image-preview" data-bs-toggle="modal" data-bs-target="#imageModal">
                <img src="https://via.placeholder.com/150" class="image-preview" data-bs-toggle="modal" data-bs-target="#imageModal">
              </div>
            </div>
          </div>

          <!-- 异议信息 -->
          <div class="alert alert-info d-none" id="disputeBox">
            <div class="fw-bold mb-1"><i class="bi bi-flag"></i> 发单用户异议</div>
            <div id="disputeReason">--</div>
          </div>

          <!-- 平台处理 -->
          <div class="info-card">
            <div class="fw-bold mb-3">平台处理</div>
            <div class="row g-2 mb-2">
              <div class="col-md-12 d-flex flex-wrap gap-2">
                <button class="btn btn-outline-primary" id="btnStartProcessing"><i class="bi bi-hourglass-split"></i> 开始处理异议</button>
                <button class="btn btn-success" id="btnNoObjection"><i class="bi bi-hand-thumbs-up"></i> 确认无异议并通过</button>
                <button class="btn btn-danger" id="btnReject"><i class="bi bi-x-circle"></i> 驳回完成凭证</button>
                <button class="btn btn-outline-warning" id="btnToggleDispute"><i class="bi bi-arrow-left-right"></i> 转入/移出异议</button>
                <button class="btn btn-primary" id="btnPatch"><i class="bi bi-journal-plus"></i> 为接单用户补录凭证并通过</button>
              </div>
            </div>

            <!-- 无异议原因 -->
            <div class="mt-2 d-none" id="noObjectionBox">
              <label class="form-label">无异议原因</label>
              <textarea class="form-control" id="noObjectionReason" rows="3" placeholder="请输入确认无异议的原因…（将记录在操作日志中）"></textarea>
              <div class="text-end mt-2">
                <button class="btn btn-success" id="btnConfirmNoObjection"><i class="bi bi-check2-circle"></i> 确认无异议</button>
              </div>
            </div>

            <!-- 驳回原因 -->
            <div class="mt-2 d-none" id="rejectBox">
              <label class="form-label">驳回原因</label>
              <textarea class="form-control" id="rejectReason" rows="3" placeholder="请详细说明驳回原因…"></textarea>
              <div class="text-end mt-2">
                <button class="btn btn-danger" id="btnConfirmReject">确认驳回</button>
              </div>
            </div>

            <!-- 补录凭证（图片上传） -->
            <div class="mt-2 d-none" id="patchBox">
              <div class="row g-2">
                <div class="col-md-6">
                  <label class="form-label">补录说明</label>
                  <textarea class="form-control" id="patchDesc" rows="3" placeholder="请输入补录说明（将记录在操作日志中）"></textarea>
                </div>
                <div class="col-md-6">
                  <label class="form-label">补录图片（可多选上传）</label>
                  <input class="form-control" id="patchImages" type="file" accept="image/*" multiple />
                  <div id="patchPreview" class="d-flex flex-wrap mt-2"></div>
                </div>
              </div>
              <div class="text-end mt-2">
                <button class="btn btn-primary" id="btnConfirmPatch"><i class="bi bi-check2-circle"></i> 确认补录并通过</button>
              </div>
            </div>

            <!-- 处理进度记录 -->
            <div class="mt-3">
              <div class="fw-bold mb-2"><i class="bi bi-activity me-1"></i> 异议处理进度</div>
              <div class="timeline" id="processTimeline"></div>
              <div class="row g-2 align-items-start mt-2">
                <div class="col-md-9">
                  <textarea id="processNote" class="form-control" rows="2" placeholder="记录处理进度要点（示例：已联系发单用户补充原始链接；等待接单用户补充截图）"></textarea>
                </div>
                <div class="col-md-3 text-end">
                  <button class="btn btn-outline-primary w-100" id="btnAddProgress"><i class="bi bi-plus-lg"></i> 添加进度</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 图片放大模态框 -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body text-center">
          <img src="https://via.placeholder.com/500" class="modal-image" alt="proof">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // =============== 顶部与侧边 ===============
    document.getElementById('sidebarToggle')?.addEventListener('click', function () {
      document.querySelector('.sidebar')?.classList.toggle('show');
    });
    document.getElementById('btnLogout')?.addEventListener('click', function(e){
      e.preventDefault();
      try{ localStorage.removeItem('auth_token'); localStorage.removeItem('user_info'); sessionStorage.clear(); }catch(err){}
      window.location.href = 'login.html';
    });

    // =============== 常量与引用 ===============
    const PAGE_SIZE = 20; let currentPage = 1;
    const table = document.getElementById('completionTable');
    const rowsAll = Array.from(table.querySelectorAll('tbody tr'));
    const selectAll = document.getElementById('selectAll');
    const batchActions = document.getElementById('batchActions');
    const selectedCount = document.getElementById('selectedCount');
    const viewTabs = document.getElementById('viewTabs');
    const pager = document.getElementById('pager');
    const pageInfo = document.getElementById('pageInfo');
    const totalCount = document.getElementById('totalCount');
    // KPI：本页聚焦“异议中/处理中”
    const kpiDispute = document.getElementById('kpiDispute');
    const kpiProcessing = document.getElementById('kpiProcessing');

    // 模态框字段
    let activeRowIndex = null; // 指向 rowsAll 的下标
    const modal = document.getElementById('completionDetailModal');
    const modalSubTitle = document.getElementById('modalSubTitle');
    const mSubmitUser = document.getElementById('mSubmitUser');
    const mSubmitTime = document.getElementById('mSubmitTime');
    const mBounty = document.getElementById('mBounty');
    const mFee = document.getElementById('mFee');
    const mNet = document.getElementById('mNet');
    const mUser = document.getElementById('mUser');
    const mUserTime = document.getElementById('mUserTime');
    const mStatusBadge = document.getElementById('mStatusBadge');
    const disputeBox = document.getElementById('disputeBox');
    const disputeReason = document.getElementById('disputeReason');
    const btnStartProcessing = document.getElementById('btnStartProcessing');

    // 平台操作按钮与容器
    const btnNoObjection = document.getElementById('btnNoObjection');
    const btnReject = document.getElementById('btnReject');
    const btnToggleDispute = document.getElementById('btnToggleDispute');
    const btnPatch = document.getElementById('btnPatch');
    const noObjectionBox = document.getElementById('noObjectionBox');
    const rejectBox = document.getElementById('rejectBox');
    const patchBox = document.getElementById('patchBox');
    const btnConfirmNoObjection = document.getElementById('btnConfirmNoObjection');
    const btnConfirmReject = document.getElementById('btnConfirmReject');
    const btnConfirmPatch = document.getElementById('btnConfirmPatch');
    const patchImages = document.getElementById('patchImages');
    const patchPreview = document.getElementById('patchPreview');

    // 处理进度
    const processTimeline = document.getElementById('processTimeline');
    const processNote = document.getElementById('processNote');
    const btnAddProgress = document.getElementById('btnAddProgress');

    // =============== 行内按钮文案更新与只读模式 ===============
    function updateActionButton(row){
      const btn = row.querySelector('.audit-btn');
      if (!btn) return;
      const st = row.dataset.status;
      if (st === 'approved' || st === 'rejected' || st === 'confirmed') {
        btn.textContent = '查看';
        btn.classList.remove('btn-outline-primary');
        btn.classList.add('btn-outline-secondary');
        btn.removeAttribute('disabled');
      } else {
        btn.textContent = '审核';
        btn.classList.remove('btn-outline-secondary');
        btn.classList.add('btn-outline-primary');
        btn.removeAttribute('disabled');
      }
    }
    function setViewOnly(isView){
      [btnStartProcessing, btnNoObjection, btnReject, btnToggleDispute, btnPatch].forEach(b => { if (b){ b.disabled = !!isView; } });
      if (isView){
        noObjectionBox.classList.add('d-none');
        rejectBox.classList.add('d-none');
        patchBox.classList.add('d-none');
      }
    }

    // =============== KPI 刷新 ===============
    function refreshKPI(){
      const dispute = rowsAll.filter(r => r.dataset.status === 'dispute').length;
      const processing = rowsAll.filter(r => r.dataset.status === 'processing').length;
      kpiDispute.textContent = dispute;
      kpiProcessing.textContent = processing;
    }

    // =============== 过滤逻辑 ===============
    function rowVisibleUnderFilter(row){
      const status = row.dataset.status; // pending/dispute/processing/approved/rejected/confirmed
      const activeView = viewTabs.querySelector('.nav-link.active').dataset.view;
      let ok = true;
      if (activeView === 'dispute') ok = status === 'dispute';
      else if (activeView === 'processing') ok = status === 'processing';
      else if (activeView === 'processed') ok = (status === 'approved' || status === 'rejected' || status === 'confirmed');
      else if (activeView === 'pending') ok = status === 'pending';
      return ok;
    }
    function getFilteredRows(){ return rowsAll.filter(rowVisibleUnderFilter); }

    // =============== 分页渲染 ===============
    function renderPagination(){
      const filtered = getFilteredRows();
      const total = filtered.length;
      const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
      if (currentPage > totalPages) currentPage = totalPages;

      rowsAll.forEach(r => r.style.display = 'none');
      const start = (currentPage - 1) * PAGE_SIZE;
      const end = Math.min(start + PAGE_SIZE, total);
      for (let i = start; i < end; i++){ filtered[i].style.display = ''; }

      // 规范化“自动确认”列展示（当前页）
      for (let i = start; i < end; i++){
        const row = filtered[i];
        const st = row.dataset.status;
        const cell = row.querySelectorAll('td')[7];
        if (!cell) continue;
        if (st === 'confirmed'){
          const who = row.dataset.confirmedBy === 'user' ? '用户确认' : '系统确认';
          cell.textContent = who;
          cell.classList.remove('near','expired');
        } else if (st === 'approved' || st === 'rejected'){
          cell.textContent = '—';
          cell.classList.remove('near','expired');
        }
      }

      pageInfo.textContent = currentPage + '/' + totalPages;
      totalCount.textContent = total;

      while (pager.firstChild) pager.removeChild(pager.firstChild);
      const addItem = (label, dataPage, disabled=false, active=false) => {
        const li = document.createElement('li');
        li.className = 'page-item' + (disabled ? ' disabled' : '') + (active ? ' active' : '');
        const a = document.createElement('a');
        a.className = 'page-link'; a.href = '#'; a.dataset.page = dataPage; a.textContent = label;
        li.appendChild(a); pager.appendChild(li);
      };
      addItem('上一页', 'prev', currentPage===1, false);
      for (let p = 1; p <= totalPages; p++) addItem(String(p), String(p), false, p===currentPage);
      addItem('下一页', 'next', currentPage===totalPages, false);
    }
    function refreshTable(){
      renderPagination();
      refreshKPI();
      updateSelectedCount();
    }

    // 绑定视图切换
    viewTabs.querySelectorAll('.nav-link').forEach(btn => {
      btn.addEventListener('click', () => {
        viewTabs.querySelectorAll('.nav-link').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentPage = 1;
        refreshTable();
      });
    });

    // 分页点击
    pager.addEventListener('click', (e) => {
      const a = e.target.closest('a.page-link'); if (!a) return;
      e.preventDefault();
      const filtered = getFilteredRows();
      const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
      const dp = a.dataset.page;
      if (dp === 'prev'){ if (currentPage > 1) currentPage--; }
      else if (dp === 'next'){ if (currentPage < totalPages) currentPage++; }
      else { currentPage = parseInt(dp, 10) || 1; }
      refreshTable();
    });

    // =============== 选择与批量 ===============
    function updateSelectedCount(){
      const visibleRows = getFilteredRows();
      const start = (currentPage - 1) * PAGE_SIZE;
      const end = Math.min(start + PAGE_SIZE, visibleRows.length);
      let selected = 0;
      for (let i = start; i < end; i++){
        const cb = visibleRows[i].querySelector('.select-item');
        if (cb && cb.checked) selected++;
      }
      selectedCount.textContent = selected;
      batchActions.style.display = selected > 0 ? 'block' : 'none';

      // 同步当前页全选状态
      let allChecked = true;
      for (let i = start; i < end; i++){
        const cb = visibleRows[i].querySelector('.select-item');
        if (!cb || !cb.checked){ allChecked = false; break; }
      }
      selectAll.checked = selected > 0 && allChecked;
    }
    selectAll.addEventListener('change', function(){
      const visibleRows = getFilteredRows();
      const start = (currentPage - 1) * PAGE_SIZE;
      const end = Math.min(start + PAGE_SIZE, visibleRows.length);
      for (let i = start; i < end; i++){
        const cb = visibleRows[i].querySelector('.select-item');
        if (cb) cb.checked = selectAll.checked;
      }
      updateSelectedCount();
    });
    rowsAll.forEach(r => {
      r.querySelector('.select-item')?.addEventListener('change', updateSelectedCount);
    });

    function getSelectedRowsOnPage(){
      const visibleRows = getFilteredRows();
      const start = (currentPage - 1) * PAGE_SIZE;
      const end = Math.min(start + PAGE_SIZE, visibleRows.length);
      const list = [];
      for (let i = start; i < end; i++){
        const r = visibleRows[i];
        if (r.querySelector('.select-item')?.checked) list.push(r);
      }
      return list;
    }
    function getSelectedRowsOnPageOrAlert(){
      const list = getSelectedRowsOnPage();
      if (list.length === 0) alert('请选择至少一条当前页的记录');
      return list;
    }

    document.getElementById('batchApproveBtn').addEventListener('click', () => {
      const list = getSelectedRowsOnPageOrAlert(); if (list.length === 0) return;
      list.forEach(r => {
        r.dataset.status = 'approved';
        r.querySelectorAll('td')[11].innerHTML = '<span class="badge badge-soft-success">已通过（批量）</span>';
        updateActionButton(r);
      });
      refreshTable();
      alert('已批量通过 ' + list.length + ' 条。');
    });

    document.getElementById('batchNoObjectionBtn').addEventListener('click', () => {
      const list = getSelectedRowsOnPageOrAlert(); if (list.length === 0) return;
      const reason = prompt('请输入“确认无异议”的原因：'); if (!reason) return;
      list.forEach(r => {
        r.dataset.status = 'approved';
        r.querySelectorAll('td')[11].innerHTML = '<span class="badge badge-soft-success">已通过（批量确认无异议）</span>';
        updateActionButton(r);
      });
      refreshTable();
      alert('已批量确认无异议并通过 ' + list.length + ' 条。原因：' + reason);
    });

    document.getElementById('batchRejectBtn').addEventListener('click', () => {
      const list = getSelectedRowsOnPageOrAlert(); if (list.length === 0) return;
      const reason = prompt('请输入批量驳回原因：'); if (!reason) return;
      list.forEach(r => {
        r.dataset.status = 'rejected';
        r.querySelectorAll('td')[11].innerHTML = '<span class="badge badge-soft-danger">已驳回（批量）</span>';
        updateActionButton(r);
      });
      refreshTable();
      alert('已批量驳回 ' + list.length + ' 条。原因：' + reason);
    });

    document.getElementById('batchToDisputeBtn').addEventListener('click', () => {
      const list = getSelectedRowsOnPageOrAlert(); if (list.length === 0) return;
      list.forEach(r => {
        if (r.dataset.status === 'pending') {
          r.dataset.status = 'dispute';
          r.dataset.dispute = r.dataset.dispute || '发单用户提起异议：证明材料不充分。';
          r.querySelectorAll('td')[11].innerHTML = '<span class="badge badge-soft-info">异议中（批量转入）</span>';
          updateActionButton(r);
        }
      });
      refreshTable();
      alert('已将 ' + list.length + ' 条转入异议栏。');
    });

    // =============== 模态框数据映射 ===============
    function populateModalFromRow(row) {
      const tds = row.querySelectorAll('td');
      const taskId = tds[1].textContent.trim();
      const taskCategory = tds[2].textContent.trim();
      const userName = tds[3].textContent.trim();
      const teamName = tds[4].textContent.trim();
      const submitTime = tds[5].textContent.trim();
      const bounty = tds[8].textContent.trim();
      const fee = tds[9].textContent.trim();
      const net = tds[10].textContent.trim();
      const status = row.dataset.status;

      modalSubTitle.textContent = '任务分类：' + taskCategory + '（任务ID：' + taskId + '）';
      mSubmitUser.textContent = userName + '（' + teamName + '）';
      mSubmitTime.textContent = submitTime;
      mBounty.textContent = bounty;
      mFee.textContent = fee;
      mNet.textContent = net;
      mUser.textContent = userName;
      mUserTime.textContent = submitTime;

      if (status === 'pending') { mStatusBadge.className = 'badge bg-warning'; mStatusBadge.textContent = '待审核'; }
      else if (status === 'dispute') { mStatusBadge.className = 'badge bg-info'; mStatusBadge.textContent = '异议中'; }
      else if (status === 'processing') { mStatusBadge.className = 'badge bg-primary'; mStatusBadge.textContent = '处理异议中'; }
      else if (status === 'approved') { mStatusBadge.className = 'badge bg-success'; mStatusBadge.textContent = '已通过'; }
      else if (status === 'rejected') { mStatusBadge.className = 'badge bg-danger'; mStatusBadge.textContent = '已驳回'; }
      else if (status === 'confirmed') { mStatusBadge.className = 'badge bg-success'; mStatusBadge.textContent = row.dataset.confirmedBy === 'user' ? '已确认（用户确认）' : '已确认（系统确认）'; }

      const reason = row.dataset.dispute || '';
      if ((status === 'dispute' || status === 'processing') && reason) {
        disputeBox.classList.remove('d-none');
        disputeReason.textContent = reason;
      } else {
        disputeBox.classList.add('d-none');
        disputeReason.textContent = '';
      }

      // 渲染进度时间线
      renderProcessTimeline(row);

      // 重置操作面板
      noObjectionBox.classList.add('d-none');
      rejectBox.classList.add('d-none');
      patchBox.classList.add('d-none');
      document.getElementById('noObjectionReason').value = '';
      document.getElementById('rejectReason').value = '';
      document.getElementById('patchDesc').value = '';
      patchImages.value = '';
      patchPreview.innerHTML = '';

      // “开始处理异议”按钮：仅在异议中可点击
      btnStartProcessing.disabled = !(row.dataset.status === 'dispute');

      // 终态进入只读
      const viewOnly = (['approved','rejected','confirmed'].includes(status));
      setViewOnly(viewOnly);
    }

    document.querySelectorAll('.audit-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tr = btn.closest('tr');
        activeRowIndex = rowsAll.indexOf(tr);
        populateModalFromRow(rowsAll[activeRowIndex]);
      });
    });

    // =============== 平台操作 ===============
    // 开始处理异议
    btnStartProcessing.addEventListener('click', () => {
      if (activeRowIndex == null) return;
      const row = rowsAll[activeRowIndex];
      if (row.dataset.status !== 'dispute') { alert('当前状态非“异议中”，无法开始处理。'); return; }
      row.dataset.status = 'processing';
      row.querySelectorAll('td')[11].innerHTML = '<span class="badge badge-soft-primary">处理异议中（平台）</span>';
      addProcessLog(row, '开始处理异议。');
      refreshTable(); updateActionButton(row); populateModalFromRow(row);
    });

    // 添加进度
    btnAddProgress.addEventListener('click', () => {
      if (activeRowIndex == null) return;
      const row = rowsAll[activeRowIndex];
      const note = (processNote.value || '').trim();
      if (!note) { alert('请输入进度内容'); return; }
      addProcessLog(row, note);
      processNote.value = '';
      renderProcessTimeline(row);
      alert('已记录进度。');
    });

    function renderProcessTimeline(row){
      const logs = getProcessLogs(row);
      processTimeline.innerHTML = '';
      logs.forEach(l => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = '<div class="small text-muted">' + l.time + '</div><div>' + escapeHtml(l.note) + '</div>';
        processTimeline.appendChild(div);
      });
    }
    function getProcessLogs(row){
      try { return JSON.parse(row.dataset.processLog || '[]'); } catch(e){ return []; }
    }
    function addProcessLog(row, note){
      const list = getProcessLogs(row);
      const now = new Date();
      const stamp = now.getFullYear() + '-' + String(now.getMonth()+1).padStart(2,'0') + '-' + String(now.getDate()).padStart(2,'0')
          + ' ' + String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0') + ':' + String(now.getSeconds()).padStart(2,'0');
      list.unshift({time: stamp, note});
      row.dataset.processLog = JSON.stringify(list);
    }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    // 无异议 -> 展开输入
    btnNoObjection.addEventListener('click', () => {
      noObjectionBox.classList.toggle('d-none');
      rejectBox.classList.add('d-none');
      patchBox.classList.add('d-none');
    });
    // 确认无异议（必须填原因）
    btnConfirmNoObjection.addEventListener('click', () => {
      const reason = document.getElementById('noObjectionReason').value.trim();
      if (!reason) { alert('请填写“无异议原因”。'); return; }
      if (activeRowIndex == null) return;
      const row = rowsAll[activeRowIndex];
      row.dataset.status = 'approved';
      row.querySelectorAll('td')[11].innerHTML = '<span class="badge badge-soft-success">已通过（平台确认无异议）</span>';
      updateActionButton(row);
      addProcessLog(row, '平台结案：确认无异议并通过。原因：' + reason);
      refreshTable();
      bootstrap.Modal.getInstance(modal).hide();
      alert('已确认无异议并通过。原因：' + reason);
    });

    // 驳回 -> 展开输入
    btnReject.addEventListener('click', () => {
      rejectBox.classList.toggle('d-none');
      noObjectionBox.classList.add('d-none');
      patchBox.classList.add('d-none');
    });
    btnConfirmReject.addEventListener('click', () => {
      const reason = document.getElementById('rejectReason').value.trim();
      if (!reason) { alert('请填写驳回原因'); return; }
      if (activeRowIndex == null) return;
      const row = rowsAll[activeRowIndex];
      row.dataset.status = 'rejected';
      row.querySelectorAll('td')[11].innerHTML = '<span class="badge badge-soft-danger">已驳回（平台）</span>';
      updateActionButton(row);
      addProcessLog(row, '平台结案：驳回完成凭证。原因：' + reason);
      refreshTable();
      bootstrap.Modal.getInstance(modal).hide();
      alert('已驳回：' + reason);
    });

    // 转入/移出异议
    btnToggleDispute.addEventListener('click', () => {
      if (activeRowIndex == null) return;
      const row = rowsAll[activeRowIndex];
      const statusCell = row.querySelectorAll('td')[11];
      if (row.dataset.status === 'dispute') {
        row.dataset.status = 'pending';
        statusCell.innerHTML = '<span class="badge badge-soft-warning">待发单确认</span>';
        addProcessLog(row, '已移出异议，返回待审核。');
      } else if (row.dataset.status === 'pending') {
        row.dataset.status = 'dispute';
        row.dataset.dispute = row.dataset.dispute || '发单用户补充：证明材料不充分。';
        statusCell.innerHTML = '<span class="badge badge-soft-info">异议中（等待平台裁定）</span>';
        addProcessLog(row, '已转入异议栏。');
      } else if (row.dataset.status === 'processing') {
        row.dataset.status = 'dispute';
        statusCell.innerHTML = '<span class="badge badge-soft-info">异议中（等待平台裁定）</span>';
        addProcessLog(row, '处理暂停：移回“异议中”。');
      } else {
        alert('仅“待审核/异议中/处理异议中”的记录可切换。');
      }
      updateActionButton(row);
      refreshTable();
      populateModalFromRow(row);
    });

    // 补录（图片上传）
    btnPatch.addEventListener('click', () => {
      patchBox.classList.toggle('d-none');
      noObjectionBox.classList.add('d-none');
      rejectBox.classList.add('d-none');
    });
    patchImages.addEventListener('change', () => {
      patchPreview.innerHTML = '';
      const files = Array.from(patchImages.files||[]);
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.className = 'image-preview';
          patchPreview.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });
    btnConfirmPatch.addEventListener('click', () => {
      const desc = document.getElementById('patchDesc').value.trim();
      if (!desc) { alert('请填写补录说明'); return; }
      const files = Array.from(patchImages.files||[]);
      if (files.length === 0) { alert('请至少上传一张补录图片'); return; }
      if (activeRowIndex == null) return;
      const row = rowsAll[activeRowIndex];
      row.dataset.status = 'approved';
      row.querySelectorAll('td')[11].innerHTML = '<span class="badge badge-soft-success">已通过（平台补录）</span>';
      updateActionButton(row);
      patchPreview.querySelectorAll('img').forEach(img => {
        const clone = img.cloneNode(true);
        document.getElementById('mImages').appendChild(clone);
      });
      addProcessLog(row, '平台补录凭证并通过。说明：' + desc + '；补录图片数：' + files.length);
      refreshTable();
      bootstrap.Modal.getInstance(modal).hide();
      alert('已补录并通过。');
    });

    // =============== 自动确认倒计时（仅 pending） ===============
    function getAutoConfirmHoursForCategory(cat){
      // 优先 localStorage.hq_autoConfirmByCategory[分类]；其次 formDesignProofDraft.settings.autoCompleteHours；默认 48 小时
      let map = {};
      try{ map = JSON.parse(localStorage.getItem('hq_autoConfirmByCategory')||'{}') || {}; }catch(e){}
      let hours = map[cat];
      if (!hours){
        try{
          const d = JSON.parse(localStorage.getItem('formDesignProofDraft')||'{}');
          hours = d && d.settings && d.settings.autoCompleteHours ? parseInt(d.settings.autoCompleteHours, 10) : null;
        }catch(e){}
      }
      return hours || 48;
    }
    function parseISOish(s){ try{ return new Date(s); }catch(e){ return new Date(NaN); } }
    function two(n){ return String(n).padStart(2,'0'); }
    function formatRemain(ms){
      if (ms <= 0) return '已到期';
      const sec = Math.floor(ms/1000);
      const d = Math.floor(sec/86400);
      const h = Math.floor((sec%86400)/3600);
      const m = Math.floor((sec%3600)/60);
      const s = sec%60;
      return (d>0? (d+'天 '):'') + two(h)+':'+two(m)+':'+two(s);
    }
    function tickCountdowns(){
      const now = Date.now();
      rowsAll.forEach(row => {
        const status = row.dataset.status;
        if (status !== 'pending') return; // 仅 pending 显示倒计时
        const cat = row.dataset.category || row.querySelectorAll('td')[2].textContent.trim();
        const hours = getAutoConfirmHoursForCategory(cat);
        const submittedAt = parseISOish(row.dataset.submittedAt || row.getAttribute('data-submitted-at'));
        if (!submittedAt || isNaN(submittedAt)) return;
        const deadline = submittedAt.getTime() + hours*3600*1000;
        const remain = deadline - now;
        const cell = row.querySelectorAll('td')[7]; // 自动确认列
        if (!cell) return;
        if (remain <= 0){
          // 到期 -> 系统确认（终态）
          row.dataset.status = 'confirmed';
          row.dataset.confirmedBy = 'system';
          cell.textContent = '系统确认';
          // 状态列（第12列，下标11）
          row.querySelectorAll('td')[11].innerHTML = '<span class="badge badge-soft-success">已确认（系统确认）</span>';
          updateActionButton(row);
          refreshKPI();
          return;
        }
        cell.textContent = formatRemain(remain);
        cell.classList.remove('near','expired');
        if (remain <= 6*3600*1000){ cell.classList.add('near'); }
      });
    }
    setInterval(tickCountdowns, 1000);
    tickCountdowns();

    
    // =============== 相对提交时间 -> 绝对时间初始化 ===============
    // 目的：便于演示，data-rel-hours 表示“提交于 X 小时前”。
    // 页面加载时，将其转为 data-submitted-at，并更新“提交时间/已提交/紧迫度”展示。
    (function initRelativeSubmittedAt(){
      rowsAll.forEach(row => {
        const relStr = row.getAttribute('data-rel-hours');
        if (!relStr) return;
        const h = parseInt(relStr, 10);
        if (isNaN(h)) return;
        const dt = new Date(Date.now() - h*3600*1000);
        row.dataset.submittedAt = dt.toISOString();
        // 更新“提交时间”列（第6列，下标5）
        const y = dt.getFullYear();
        const mon = String(dt.getMonth()+1).padStart(2,'0');
        const d = String(dt.getDate()).padStart(2,'0');
        const hh = String(dt.getHours()).padStart(2,'0');
        const mm = String(dt.getMinutes()).padStart(2,'0');
        row.querySelectorAll('td')[5].textContent = y + '-' + mon + '-' + d + ' ' + hh + ':' + mm;
        // 更新“已提交”列的“X小时”
        const elapsedSpan = row.querySelector('.elapsed');
        if (elapsedSpan) elapsedSpan.textContent = h + '小时';
        // 根据小时数更新紧迫度颜色
        const dot = row.querySelector('.urgency-indicator');
        if (dot){
          dot.classList.remove('urgency-low','urgency-medium','urgency-high');
          if (h >= 24) dot.classList.add('urgency-high');
          else if (h >= 6) dot.classList.add('urgency-medium');
          else dot.classList.add('urgency-low');
        }
      });
    })();

    // =============== 初次渲染 ===============
    refreshTable();
    rowsAll.forEach(r => updateActionButton(r));
  </script>

<script>
// 侧边栏统一：插入“系统设置”（接口管理与监控下方），隐藏“数据概览/团队投诉反馈”
(function(){
  try{
    const aside = document.querySelector('aside.sidebar');
    if(aside){
      const links = aside.querySelectorAll('a');
      let apiLink = null, settingsLinkExists = false;
      links.forEach(a=>{
        if(a.textContent && a.textContent.includes('接口管理与监控')) apiLink = a;
        if(a.textContent && a.textContent.trim() === '系统设置') settingsLinkExists = true;
      });
      if(apiLink && !settingsLinkExists){
        const li = document.createElement('li'); li.className = 'nav-item';
        const a = document.createElement('a'); a.className='nav-link'; a.textContent='系统设置';
        a.href = 'hq-admin-settings-system_v1.2.1d_tabs.html';
        li.appendChild(a);
        const parentUl = apiLink.closest('ul') || aside.querySelector('ul');
        parentUl.insertBefore(li, apiLink.parentElement.nextSibling);
      }
      // 隐藏“数据概览”“团队投诉反馈”
      links.forEach(a=>{
        const t = (a.textContent||'').trim();
        if(t.includes('数据概览') || t.includes('团队投诉反馈')){
          const li = a.closest('li'); if(li) li.style.display='none';
        }
      });
    }
  }catch(e){ console.warn('侧边栏统一失败', e); }
})();
</script>


<script>
// 将表格中的编号（TSK/TPA/TFA/RCG/WDU/WDT/TF/UF/GF/FBK...）自动变为可点击链接
(function(){
  const map = {
    TSK: 'hq-admin-task-detail.html',
    TPA: 'hq-admin-audit-task-publish.html',
    TFA: 'hq-admin-audit-task-completion.html',
    RCG: 'hq-admin-finance-recharge-review.html',
    WDU: 'hq-admin-finance-withdrawal-review.html',
    WDT: 'hq-admin-finance-team-withdrawal-review.html',
    TF:  'hq-admin-finance-platform-fund-flow.html',
    UF:  'hq-admin-finance-user-fund-flow.html',
    GF:  'hq-admin-finance-team-fund-flow.html',
    FBK: 'hq-admin-users-feedback.html',
    CAT: 'hq-admin-settings-categories.html',
    FRM: 'hq-admin-form-design.html',
    APP: 'hq-admin-system-api-management-monitoring.html',
    MSG: 'hq-admin-users-feedback.html',
    LOG: 'hq-admin-audit-task-completion.html',
    U:   'hq-admin-users-list.html',
    G:   'hq-admin-team-list.html'
  };
  const re = /\b(TSK|TPA|TFA|RCG|WDU|WDT|TF|UF|GF|FBK|CAT|FRM|APP|MSG|LOG|U|G)\d{4,}(?:\s*\d{3,})?\b/g;
  function linkifyNode(node){
    if(node.children && node.children.length) return;
    const text = node.textContent;
    if(!text || !re.test(text)) return;
    const html = text.replace(re, (m)=>{
      const pref = m.match(/^[A-Z]+/)[0];
      const href = map[pref] || '#';
      const q = encodeURIComponent(m.replace(/\s+/g,''));
      return `<a href="${href}?id=${q}" class="text-decoration-underline">${m}</a>`;
    });
    const span = document.createElement('span'); span.innerHTML = html;
    node.replaceWith(span);
  }
  const targets = Array.from(document.querySelectorAll('td, span, div, p, li'));
  targets.forEach(linkifyNode);
})();
</script>


<style>
/* 统一状态样式 */
.unified-empty { text-align:center; padding:28px 12px; color:#6c757d; }
.unified-empty .icon { display:inline-block; width:36px; height:36px; border-radius:50%; border:2px dashed #ced4da; margin-bottom:6px; }
.unified-loading { position:relative; min-height:80px; }
.unified-loading:after {
  content:""; position:absolute; inset:0; background:
    linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.04) 50%, rgba(0,0,0,0) 100%);
  animation: shimmer 1.2s infinite;
}
@keyframes shimmer { 0%{background-position:-200% 0;} 100%{background-position:200% 0;} }
.unified-error { color:#dc3545; padding:8px 0; }

/* 统一筛选浮层 */
#unifiedFilterPanel {
  position: fixed; right: 16px; top: 84px; width: 360px; z-index: 1080;
  background: #fff; border: 1px solid #dee2e6; border-radius: 12px; box-shadow: 0 6px 24px rgba(0,0,0,.12);
  display:none;
}
#unifiedFilterPanel .hdr { padding: 10px 12px; border-bottom:1px solid #eee; display:flex; align-items:center; justify-content:space-between; }
#unifiedFilterPanel .bd { padding: 12px; }
#btnUnifiedFilter { margin-left: 8px; }

/* 按钮意图颜色统一（基于文本） */
button, .btn { transition: filter .2s ease; }
.btn-intent-approve { background:#198754; color:#fff; border-color:#198754; }
.btn-intent-reject { background:#dc3545; color:#fff; border-color:#dc3545; }
.btn-intent-return { background:#ffc107; color:#212529; border-color:#ffc107; }
.btn-intent-pay { background:#0d6efd; color:#fff; border-color:#0d6efd; }

/* 可点击编号统一下划线（若页面未设置） */
a.id-link { text-decoration: underline; }
</style>

<script>
(function(){
  // ===== 读取系统设置（货币/精度/时区） =====
  const PUB_KEY = 'hq_sys_settings_v1_2_1d_published';
  let locale = { lang:'zh-CN', tz:'Asia/Shanghai', currency:'CNY', precision:2 };
  try{
    const cfg = JSON.parse(localStorage.getItem(PUB_KEY)||'{}');
    if(cfg.locale){
      locale.lang = cfg.locale.lang || locale.lang;
      locale.tz = cfg.locale.tz || locale.tz;
      locale.currency = cfg.locale.currency || locale.currency;
      locale.precision = parseInt(cfg.locale.precision||locale.precision,10);
    }
  }catch(e){}

  // ===== 统一筛选：在首个 .card-header 右侧添加“筛选”按钮 + 浮层 =====
  function ensureFilterUI(){
    if(document.getElementById('unifiedFilterPanel')) return;
    const btn = document.createElement('button');
    btn.className = 'btn btn-outline-secondary btn-sm';
    btn.id = 'btnUnifiedFilter';
    btn.innerHTML = '<i class="bi bi-funnel me-1"></i>筛选';
    // 尝试挂到第一个 card-header 右侧
    const hdr = document.querySelector('.card .card-header') || document.querySelector('.d-flex.align-items-center.justify-content-between');
    if(hdr){ hdr.appendChild(btn); }
    else {
      // 顶部右上角浮动按钮（兜底）
      const fbtn = btn.cloneNode(true);
      fbtn.style.position='fixed'; fbtn.style.right='16px'; fbtn.style.top='20px'; fbtn.style.zIndex='1080';
      document.body.appendChild(fbtn);
    }

    const panel = document.createElement('div');
    panel.id = 'unifiedFilterPanel';
    panel.innerHTML = `
      <div class="hdr">
        <strong>通用筛选</strong>
        <button type="button" class="btn-close" id="btnUFclose"></button>
      </div>
      <div class="bd">
        <div class="mb-2">
          <label class="form-label">关键字</label>
          <input class="form-control" id="uf-key" placeholder="编号/手机号/名称">
        </div>
        <div class="mb-2">
          <label class="form-label">状态</label>
          <select class="form-select" id="uf-status">
            <option value="">全部</option>
            <option>待处理</option>
            <option>处理中</option>
            <option>已通过</option>
            <option>已驳回</option>
            <option>已完成</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">时间范围</label>
          <div class="d-flex gap-2">
            <input type="date" class="form-control" id="uf-from">
            <input type="date" class="form-control" id="uf-to">
          </div>
        </div>
        <div class="d-flex justify-content-end gap-2">
          <button class="btn btn-outline-secondary btn-sm" id="uf-reset">重置</button>
          <button class="btn btn-primary btn-sm" id="uf-apply">应用</button>
        </div>
      </div>
    `;
    document.body.appendChild(panel);

    document.body.addEventListener('click', function(e){
      if(e.target && (e.target.id==='btnUnifiedFilter')){
        const p = document.getElementById('unifiedFilterPanel');
        p.style.display = (p.style.display==='none' || !p.style.display) ? 'block' : 'none';
      }
      if(e.target && (e.target.id==='btnUFclose')){
        document.getElementById('unifiedFilterPanel').style.display = 'none';
      }
      if(e.target && (e.target.id==='uf-reset')){
        document.getElementById('uf-key').value='';
        document.getElementById('uf-status').value='';
        document.getElementById('uf-from').value='';
        document.getElementById('uf-to').value='';
        // 客户端演示：移除高亮
        document.querySelectorAll('.uf-hl').forEach(n=>n.classList.remove('uf-hl'));
      }
      if(e.target && (e.target.id==='uf-apply')){
        // Demo：仅做关键字高亮；实际项目应触发具体表格筛选逻辑
        const key = (document.getElementById('uf-key').value||'').trim();
        document.querySelectorAll('.uf-hl').forEach(n=>n.classList.remove('uf-hl'));
        if(key){
          const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT);
          const re = new RegExp(key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'i');
          let node; while(node = walker.nextNode()){
            if(re.test(node.nodeValue) && node.parentElement && node.parentElement.closest('table')){
              node.parentElement.classList.add('uf-hl');
            }
          }
        }
        document.getElementById('unifiedFilterPanel').style.display = 'none';
      }
    });

    const style = document.createElement('style');
    style.textContent = `.uf-hl{ background: rgba(255, 230, 0, .45); outline: 1px dashed #ffbf00; }`;
    document.head.appendChild(style);
  }

  // ===== 统一金额格式（根据表头关键字判列） =====
  function unifyAmountFormat(){
    const tables = Array.from(document.querySelectorAll('table'));
    const nf = new Intl.NumberFormat(locale.lang, { style:'currency', currency: locale.currency, minimumFractionDigits: locale.precision, maximumFractionDigits: locale.precision });
    tables.forEach(tb=>{
      const ths = Array.from(tb.querySelectorAll('thead th, thead td')).map(th => (th.textContent||'').trim());
      if(!ths.length) return;
      ths.forEach((txt, idx)=>{
        if(/金额|价|费|收款|打款|入账|出账/.test(txt)){
          Array.from(tb.querySelectorAll(`tbody tr`)).forEach(tr=>{
            const td = tr.children[idx]; if(!td) return;
            const raw = (td.textContent||'').replace(/[,￥$]/g,'').trim();
            const num = parseFloat(raw);
            if(!isNaN(num)){
              td.setAttribute('data-raw-amount', num);
              td.textContent = nf.format(num);
              td.style.fontFamily = 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace';
              td.style.textAlign = 'right';
            }
          });
        }
      });
    });
  }

  // ===== 统一时间格式 =====
  function unifyTimeFormat(){
    const tables = Array.from(document.querySelectorAll('table'));
    const fmt = new Intl.DateTimeFormat(locale.lang, { timeZone: locale.tz, year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit' });
    tables.forEach(tb=>{
      const ths = Array.from(tb.querySelectorAll('thead th, thead td')).map(th => (th.textContent||'').trim());
      if(!ths.length) return;
      ths.forEach((txt, idx)=>{
        if(/时间|日期|创建|更新/.test(txt)){
          Array.from(tb.querySelectorAll(`tbody tr`)).forEach(tr=>{
            const td = tr.children[idx]; if(!td) return;
            const s = (td.textContent||'').trim();
            // 常见格式 "YYYY-MM-DD HH:mm[:ss]"
            const iso = s.replace(/(\d{4}-\d{2}-\d{2})[ T](\d{2}:\d{2}(:\d{2})?)/, '$1T$2');
            const d = new Date(iso);
            if(!isNaN(+d)){
              td.title = d.toISOString();
              td.textContent = fmt.format(d);
              td.style.whiteSpace = 'nowrap';
            }
          });
        }
      });
    });
  }

  // ===== 空态填充（无数据时） =====
  function fillEmptyStates(){
    Array.from(document.querySelectorAll('table')).forEach(tb=>{
      const body = tb.querySelector('tbody'); if(!body) return;
      const hasRow = body.querySelector('tr');
      if(!hasRow){
        const colSpan = (tb.querySelectorAll('thead th').length || 1);
        const tr = document.createElement('tr');
        const td = document.createElement('td'); td.colSpan = colSpan; td.className='unified-empty';
        td.innerHTML = '<div class="icon"></div><div>暂无数据</div>';
        tr.appendChild(td); body.appendChild(tr);
      }
    });
  }

  // ===== 动作按钮意图着色（基于文本内容） =====
  function colorizeActionButtons(){
    const btns = Array.from(document.querySelectorAll('button, a.btn'));
    btns.forEach(b=>{
      const t = (b.textContent||'').trim();
      if(/通过|同意|Approve/i.test(t)) b.classList.add('btn-intent-approve');
      if(/驳回|拒绝|Reject/i.test(t)) b.classList.add('btn-intent-reject');
      if(/打回|退回|Return/i.test(t)) b.classList.add('btn-intent-return');
      if(/打款|已转账|Pay/i.test(t)) b.classList.add('btn-intent-pay');
    });
  }

  // ===== 启动顺序 =====
  document.addEventListener('DOMContentLoaded', function(){
    ensureFilterUI();
    unifyAmountFormat();
    unifyTimeFormat();
    fillEmptyStates();
    colorizeActionButtons();
  });
})();
</script>


<script>
(function(){
  // 统一“通知回执”与“总部收件箱”写入
  const PUB_KEY = 'hq_sys_settings_v1_2_1d_published';

  function pushHQInbox(msg){
    try{
      const cfg = JSON.parse(localStorage.getItem(PUB_KEY) || '{}');
      const inbox = (cfg.notifySite && cfg.notifySite.hq && Array.isArray(cfg.notifySite.hq.inbox)) ? cfg.notifySite.hq.inbox : [];
      inbox.unshift(msg);
      if(!cfg.notifySite) cfg.notifySite = {};
      if(!cfg.notifySite.hq) cfg.notifySite.hq = {};
      cfg.notifySite.hq.inbox = inbox.slice(0, 500); // 限制长度
      localStorage.setItem(PUB_KEY, JSON.stringify(cfg));
      // 触发 storage 监听（同页不会触发），这里手动广播一次
      window.dispatchEvent(new StorageEvent('storage', {key: PUB_KEY, newValue: JSON.stringify(cfg)}));
    }catch(e){ console.warn('写入总部收件箱失败', e); }
  }

  function toast(msg, link){
    let wrap = document.getElementById('p2ToastWrap');
    if(!wrap){
      wrap = document.createElement('div');
      wrap.id = 'p2ToastWrap';
      wrap.style.position='fixed'; wrap.style.right='16px'; wrap.style.bottom='16px';
      wrap.style.zIndex='2000'; document.body.appendChild(wrap);
    }
    const el = document.createElement('div');
    el.style.background='#212529'; el.style.color='#fff'; el.style.padding='10px 12px'; el.style.borderRadius='10px';
    el.style.boxShadow='0 6px 18px rgba(0,0,0,.2)'; el.style.marginTop='8px'; el.style.maxWidth='360px';
    el.innerHTML = `<div>${msg}${link?`　<a href="${link}" class="link-light text-decoration-underline" target="_blank">查看总部收件箱</a>`:''}</div>`;
    wrap.appendChild(el);
    setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translateY(10px)'; el.style.transition='all .3s'; setTimeout(()=>el.remove(), 350); }, 2200);
  }

  function nowStr(){
    const d = new Date();
    const pad = (n)=>String(n).padStart(2,'0');
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }

  function getIdFromUrl(){
    try{
      const u = new URL(location.href);
      return u.searchParams.get('id') || '';
    }catch(e){ return ''; }
  }

  // 财务：监听“选择付款账户”确认按钮（如存在则联动）
  document.addEventListener('click', function(e){
    if(e.target && e.target.id === 'btnConfirmPayout'){
      let count = 1; // 总部
      let type = '财务';
      let summary = '已完成打款操作';
      if(location.pathname.includes('recharge')){ type='充值'; summary='充值审核已通过'; count = 2; }
      if(location.pathname.includes('withdrawal') && !location.pathname.includes('team')){ type='提现（个人）'; summary='个人提现已转账'; count = 3; }
      if(location.pathname.includes('team-withdrawal')){ type='提现（团队）'; summary='团队提现已转账'; count = 3; }
      const id = getIdFromUrl();
      pushHQInbox({time: nowStr(), type, summary: (id? (summary+' '+id) : summary), read:false});
      toast(`已发送 ${count} 条通知（模拟）`, 'hq-admin-settings-system_v1.2.1d_tabs_p2.html#tab-notify-site');
    }
  }, true);

  // 审核页：监听“通过/驳回/打回”按钮文本
  document.addEventListener('click', function(e){
    const btn = e.target.closest('button, a.btn');
    if(!btn) return;
    const text = (btn.textContent||'').trim();
    if(/通过|驳回|打回/i.test(text)){
      let type = '任务审核';
      if(location.pathname.includes('publish')) type = '任务发布审核';
      if(location.pathname.includes('completion')) type = '任务完成审核';
      const id = getIdFromUrl();
      const summary = `${text} ${id||''}`.trim();
      pushHQInbox({time: nowStr(), type, summary, read:false});
      const count = /驳回/.test(text) ? 2 : 3;
      toast(`已发送 ${count} 条通知（模拟）`, 'hq-admin-settings-system_v1.2.1d_tabs_p2.html#tab-notify-site');
    }
  }, true);
})();
</script>

</body>
</html>
